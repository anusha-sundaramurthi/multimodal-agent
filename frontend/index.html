<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multi-Modal AI Agent</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f0f13;
      --surface: #1a1a24;
      --surface2: #22222f;
      --border: #2e2e40;
      --accent: #7c6aff;
      --accent2: #a78bfa;
      --text: #e8e8f0;
      --muted: #7070a0;
      --green: #34d399;
      --red: #f87171;
      --yellow: #fbbf24;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    header {
      padding: 1.25rem 2rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--surface);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem;
    }

    .logo h1 { font-size: 1.1rem; font-weight: 600; letter-spacing: -0.3px; }
    .logo span { font-size: 0.75rem; color: var(--muted); display: block; margin-top: 1px; }

    .status-badge {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.4rem 0.9rem;
      border-radius: 20px;
      border: 1px solid var(--border);
      font-size: 0.78rem;
      background: var(--surface2);
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .status-badge:hover { border-color: var(--accent); }
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--yellow);
      transition: background 0.3s;
    }
    .status-dot.online { background: var(--green); animation: pulse 2s infinite; }
    .status-dot.offline { background: var(--red); }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Main layout */
    main {
      flex: 1;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 0;
      max-height: calc(100vh - 65px);
    }

    /* Sidebar */
    .sidebar {
      border-right: 1px solid var(--border);
      background: var(--surface);
      padding: 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      overflow-y: auto;
    }

    .sidebar h2 { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 0.5rem; }

    .example-btn {
      width: 100%;
      text-align: left;
      padding: 0.65rem 0.85rem;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.82rem;
      cursor: pointer;
      transition: all 0.15s;
      line-height: 1.4;
    }
    .example-btn:hover { border-color: var(--accent); background: rgba(124,106,255,0.08); }

    .tag {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 4px;
      font-size: 0.65rem;
      font-weight: 600;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .tag.qa { background: rgba(52,211,153,0.15); color: var(--green); }
    .tag.image { background: rgba(124,106,255,0.15); color: var(--accent2); }
    .tag.video { background: rgba(251,191,36,0.15); color: var(--yellow); }

    /* Content area */
    .content {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Output area */
    .output-area {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    /* Welcome screen */
    .welcome {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 3rem;
      gap: 1rem;
    }
    .welcome-icon { font-size: 3.5rem; margin-bottom: 0.5rem; }
    .welcome h2 { font-size: 1.5rem; font-weight: 600; }
    .welcome p { color: var(--muted); max-width: 400px; line-height: 1.6; font-size: 0.9rem; }
    .capabilities {
      display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap; justify-content: center;
    }
    .cap-card {
      padding: 0.75rem 1.25rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 0.82rem;
      display: flex; align-items: center; gap: 0.5rem;
    }

    /* Result cards */
    .result-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .result-header {
      padding: 0.85rem 1.25rem;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
    }
    .result-header .left { display: flex; align-items: center; gap: 0.6rem; }
    .result-prompt { font-size: 0.85rem; color: var(--muted); font-style: italic; }
    .result-type-badge {
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .result-type-badge.qa { background: rgba(52,211,153,0.15); color: var(--green); }
    .result-type-badge.image { background: rgba(124,106,255,0.15); color: var(--accent2); }
    .result-type-badge.video { background: rgba(251,191,36,0.15); color: var(--yellow); }

    .result-body { padding: 1.25rem; }
    .result-body p { line-height: 1.7; font-size: 0.9rem; color: var(--text); }

    .result-body img {
      max-width: 100%; border-radius: 8px;
      display: block;
      border: 1px solid var(--border);
    }
    .result-body video {
      max-width: 100%; border-radius: 8px;
      display: block;
      background: #000;
    }

    .expanded-prompt {
      margin-top: 0.75rem;
      padding: 0.65rem 0.9rem;
      background: var(--surface2);
      border-radius: 6px;
      font-size: 0.78rem;
      color: var(--muted);
      border-left: 3px solid var(--accent);
    }
    .expanded-prompt strong { color: var(--text); display: block; margin-bottom: 3px; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Loading state */
    .loading-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      animation: fadeIn 0.3s ease;
    }
    .spinner {
      width: 28px; height: 28px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      flex-shrink: 0;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text h3 { font-size: 0.9rem; font-weight: 600; }
    .loading-text p { font-size: 0.8rem; color: var(--muted); margin-top: 3px; }

    /* Error card */
    .error-card {
      background: rgba(248,113,113,0.08);
      border: 1px solid rgba(248,113,113,0.3);
      border-radius: 12px;
      padding: 1.25rem;
      font-size: 0.85rem;
      color: var(--red);
      animation: fadeIn 0.3s ease;
    }

    /* Input area */
    .input-area {
      padding: 1.25rem 2rem;
      border-top: 1px solid var(--border);
      background: var(--surface);
    }
    .input-row {
      display: flex;
      gap: 0.75rem;
      align-items: flex-end;
    }
    textarea {
      flex: 1;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 0.9rem;
      padding: 0.85rem 1rem;
      resize: none;
      min-height: 52px;
      max-height: 140px;
      font-family: inherit;
      transition: border-color 0.2s;
      line-height: 1.5;
    }
    textarea:focus { outline: none; border-color: var(--accent); }
    textarea::placeholder { color: var(--muted); }

    .send-btn {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 1.1rem;
      width: 52px; height: 52px;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .send-btn:hover { opacity: 0.9; }
    .send-btn:active { transform: scale(0.96); }
    .send-btn:disabled { opacity: 0.4; cursor: not-allowed; }

    .input-hint { font-size: 0.72rem; color: var(--muted); margin-top: 0.5rem; text-align: center; }

    /* Responsive */
    @media (max-width: 700px) {
      main { grid-template-columns: 1fr; }
      .sidebar { display: none; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">ğŸ¤–</div>
    <div>
      <h1>Multi-Modal AI Agent</h1>
      <span>Text â€¢ Image â€¢ Video Generation</span>
    </div>
  </div>
  <div class="status-badge" onclick="checkStatus()" title="Click to check server status">
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText">Checking...</span>
  </div>
</header>

<main>
  <!-- Sidebar with examples -->
  <aside class="sidebar">
    <div>
      <h2>ğŸ’¬ Q&amp;A Examples</h2>
      <div style="display:flex;flex-direction:column;gap:0.4rem">
        <button class="example-btn" onclick="setPrompt(this.dataset.prompt)" data-prompt="What is the difference between machine learning and deep learning?">
          <span class="tag qa">Q&amp;A</span><br>
          What is the difference between ML and deep learning?
        </button>
        <button class="example-btn" onclick="setPrompt(this.dataset.prompt)" data-prompt="Explain how diffusion models work in simple terms">
          <span class="tag qa">Q&amp;A</span><br>
          Explain how diffusion models work
        </button>
      </div>
    </div>
    <div>
      <h2>ğŸ–¼ï¸ Image Examples</h2>
      <div style="display:flex;flex-direction:column;gap:0.4rem">
        <button class="example-btn" onclick="setPrompt(this.dataset.prompt)" data-prompt="Generate an image of a cozy cabin in snowy mountains at dusk">
          <span class="tag image">Image</span><br>
          Cozy cabin in snowy mountains at dusk
        </button>
        <button class="example-btn" onclick="setPrompt(this.dataset.prompt)" data-prompt="Create a picture of a futuristic city skyline with neon lights at night">
          <span class="tag image">Image</span><br>
          Futuristic city skyline with neon lights
        </button>
        <button class="example-btn" onclick="setPrompt(this.dataset.prompt)" data-prompt="Generate an image of a golden retriever playing in autumn leaves, photorealistic">
          <span class="tag image">Image</span><br>
          Golden retriever in autumn leaves
        </button>
      </div>
    </div>
    <div>
      <h2>ğŸ¬ Video Examples</h2>
      <div style="display:flex;flex-direction:column;gap:0.4rem">
        <button class="example-btn" onclick="setPrompt(this.dataset.prompt)" data-prompt="Create a video of waves crashing on a tropical beach at sunset">
          <span class="tag video">Video</span><br>
          Waves crashing on a tropical beach
        </button>
        <button class="example-btn" onclick="setPrompt(this.dataset.prompt)" data-prompt="Generate a video of a panda eating bamboo in a lush forest">
          <span class="tag video">Video</span><br>
          Panda eating bamboo in a forest
        </button>
      </div>
    </div>
  </aside>

  <!-- Main content -->
  <div class="content">
    <div class="output-area" id="outputArea">
      <!-- Welcome screen shown initially -->
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-icon">âœ¨</div>
        <h2>What would you like to create?</h2>
        <p>This agent automatically detects your intent and routes to the right AI model â€” no need to specify which one.</p>
        <div class="capabilities">
          <div class="cap-card">ğŸ’¬ Answer questions</div>
          <div class="cap-card">ğŸ–¼ï¸ Generate images</div>
          <div class="cap-card">ğŸ¬ Create videos</div>
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="input-area">
      <div class="input-row">
        <textarea
          id="promptInput"
          placeholder="Ask anything, request an image, or describe a video..."
          rows="1"
          onkeydown="handleKeydown(event)"
          oninput="autoResize(this)"
        ></textarea>
        <button class="send-btn" id="sendBtn" onclick="submitPrompt()" title="Send (Enter)">â¤</button>
      </div>
      <p class="input-hint">Press Enter to send &nbsp;Â·&nbsp; Shift+Enter for new line</p>
    </div>
  </div>
</main>

<script>
  const API_BASE = window.location.origin;

  // â”€â”€ Status check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function checkStatus() {
    const dot = document.getElementById('statusDot');
    const text = document.getElementById('statusText');
    dot.className = 'status-dot';
    text.textContent = 'Checking...';
    try {
      const res = await fetch(`${API_BASE}/api/colab-status`);
      const data = await res.json();
      if (data.online) {
        dot.className = 'status-dot online';
        text.textContent = 'Models Online';
      } else {
        dot.className = 'status-dot offline';
        text.textContent = 'Models Offline';
      }
    } catch {
      dot.className = 'status-dot offline';
      text.textContent = 'Server Error';
    }
  }

  checkStatus();
  setInterval(checkStatus, 30000);

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setPrompt(text) {
    const input = document.getElementById('promptInput');
    input.value = text;
    autoResize(input);
    input.focus();
  }

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 140) + 'px';
  }

  function handleKeydown(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      submitPrompt();
    }
  }

  function hideWelcome() {
    const welcome = document.getElementById('welcomeScreen');
    if (welcome) welcome.remove();
  }

  // â”€â”€ Submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function submitPrompt() {
    const input = document.getElementById('promptInput');
    const prompt = input.value.trim();
    if (!prompt) return;

    const sendBtn = document.getElementById('sendBtn');
    sendBtn.disabled = true;
    input.value = '';
    autoResize(input);
    hideWelcome();

    const outputArea = document.getElementById('outputArea');

    // Show user prompt bubble
    const userBubble = document.createElement('div');
    userBubble.style.cssText = `
      align-self: flex-end;
      background: linear-gradient(135deg, #7c6aff22, #a78bfa22);
      border: 1px solid #7c6aff44;
      border-radius: 12px;
      padding: 0.85rem 1.1rem;
      max-width: 80%;
      font-size: 0.9rem;
      animation: fadeIn 0.2s ease;
    `;
    userBubble.textContent = prompt;
    outputArea.appendChild(userBubble);

    // Show loading card
    const loadingCard = document.createElement('div');
    loadingCard.className = 'loading-card';
    loadingCard.innerHTML = `
      <div class="spinner"></div>
      <div class="loading-text">
        <h3>Processing your request...</h3>
        <p>Classifying intent â†’ routing to the right model</p>
      </div>
    `;
    outputArea.appendChild(loadingCard);
    outputArea.scrollTop = outputArea.scrollHeight;

    try {
      const res = await fetch(`${API_BASE}/api/generate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt })
      });

      loadingCard.remove();

      if (!res.ok) {
        const err = await res.json();
        throw new Error(err.detail || 'Unknown error');
      }

      const data = await res.json();
      renderResult(data, prompt, outputArea);

    } catch (err) {
      loadingCard.remove();
      const errorCard = document.createElement('div');
      errorCard.className = 'error-card';
      errorCard.innerHTML = `âš ï¸ <strong>Error:</strong> ${err.message}`;
      outputArea.appendChild(errorCard);
    }

    sendBtn.disabled = false;
    outputArea.scrollTop = outputArea.scrollHeight;
    input.focus();
  }

  // â”€â”€ Render result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderResult(data, originalPrompt, outputArea) {
    const card = document.createElement('div');
    card.className = 'result-card';

    const typeLabel = { qa: 'ğŸ’¬ Answer', image: 'ğŸ–¼ï¸ Image', video: 'ğŸ¬ Video' }[data.type] || data.type;
    const badgeClass = data.type;

    let bodyHTML = '';

    if (data.type === 'qa') {
      bodyHTML = `<p>${escapeHTML(data.data).replace(/\n/g, '<br>')}</p>`;

    } else if (data.type === 'image') {
      bodyHTML = `
        <img src="data:image/png;base64,${data.data}" alt="Generated image" />
        <div class="expanded-prompt">
          <strong>âœ¨ Expanded Prompt</strong>
          ${escapeHTML(data.prompt)}
        </div>
        <div style="margin-top:0.75rem">
          <a href="data:image/png;base64,${data.data}" download="generated_image.png"
             style="font-size:0.8rem;color:var(--accent2);text-decoration:none;">
            â¬‡ Download Image
          </a>
        </div>
      `;

    } else if (data.type === 'video') {
      const videoSrc = `data:video/mp4;base64,${data.data}`;
      bodyHTML = `
        <video controls autoplay loop muted>
          <source src="${videoSrc}" type="video/mp4" />
          Your browser does not support video playback.
        </video>
        <div class="expanded-prompt">
          <strong>âœ¨ Expanded Prompt</strong>
          ${escapeHTML(data.prompt)}
        </div>
        <div style="margin-top:0.75rem">
          <a href="${videoSrc}" download="generated_video.mp4"
             style="font-size:0.8rem;color:var(--yellow);text-decoration:none;">
            â¬‡ Download Video
          </a>
        </div>
      `;
    }

    card.innerHTML = `
      <div class="result-header">
        <div class="left">
          <span class="result-type-badge ${badgeClass}">${typeLabel}</span>
          <span class="result-prompt">"${escapeHTML(originalPrompt.slice(0, 60))}${originalPrompt.length > 60 ? 'â€¦' : ''}"</span>
        </div>
      </div>
      <div class="result-body">${bodyHTML}</div>
    `;

    outputArea.appendChild(card);
  }

  function escapeHTML(str) {
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
</script>

</body>
</html>
